(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();let P,N=!1;const ie=new Promise(e=>{P=e});function K(){var e,n,o,i;if(console.log("window.__TAURI__ available?",typeof window.__TAURI__),console.log("window.__TAURI__ keys:",window.__TAURI__?Object.keys(window.__TAURI__):"undefined"),!window.__TAURI__)return!1;window.Tauri||(window.Tauri={});try{if(window.Tauri.invoke=((e=window.__TAURI__.core)==null?void 0:e.invoke)||((n=window.__TAURI__.tauri)==null?void 0:n.invoke),window.Tauri.listen=(o=window.__TAURI__.event)==null?void 0:o.listen,window.Tauri.emit=(i=window.__TAURI__.event)==null?void 0:i.emit,window.__TAURI__.webviewWindow){const{WebviewWindow:s}=window.__TAURI__.webviewWindow;window.Tauri.appWindow=s.getCurrent()}else if(window.__TAURI__.window){const{getCurrent:s}=window.__TAURI__.window;window.Tauri.appWindow=s()}return N=!0,P(window.Tauri),!0}catch(s){return console.error("Error loading Tauri APIs:",s),!1}}K()||(window.addEventListener("tauri://ready",()=>{N||K()},{once:!0}),setTimeout(()=>{N||(console.warn("Tauri APIs not detected. Continuing without native bridge."),window.Tauri||(window.Tauri={}),P(window.Tauri))},2e3));function V(){return ie}(function(){let e=null;V().then(()=>{var i,s,r,c,f;e=((i=window.Tauri)==null?void 0:i.invoke)||((r=(s=window.__TAURI__)==null?void 0:s.core)==null?void 0:r.invoke)||((f=(c=window.__TAURI__)==null?void 0:c.tauri)==null?void 0:f.invoke),e||console.error("SessionReview: Tauri invoke not available")}).catch(i=>{console.error("SessionReview: failed to initialize Tauri bridge",i)});class n{constructor(){this.isOpen=!1,this.sessionStartTime=null,this.entries=[],this.drawerEl=null,this.triggerBtn=null,this.closeBtn=null,this.entriesContainer=null,this.summaryEl=null,this.emptyStateEl=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.refresh=this.refresh.bind(this),this.handleCheckInCreated=this.handleCheckInCreated.bind(this)}init(){if(this.drawerEl=document.getElementById("reviewDrawer"),this.triggerBtn=document.getElementById("reviewTrigger"),this.closeBtn=document.getElementById("reviewClose"),this.entriesContainer=document.getElementById("reviewEntries"),this.summaryEl=document.getElementById("reviewSummary"),this.emptyStateEl=document.getElementById("reviewEmptyState"),!this.drawerEl||!this.triggerBtn){console.error("Session review elements not found in DOM");return}this.triggerBtn.addEventListener("click",this.toggle),this.closeBtn&&this.closeBtn.addEventListener("click",this.close),window.addEventListener("ft:checkin-created",this.handleCheckInCreated),console.log("Session Review module initialized")}setSessionStartTime(s){this.sessionStartTime=s,console.log("Session start time set:",this.sessionStartTime.toISOString())}async open(){this.isOpen||(this.isOpen=!0,this.drawerEl.classList.add("open"),this.drawerEl.setAttribute("aria-expanded","true"),this.triggerBtn.setAttribute("aria-pressed","true"),await this.refresh())}close(){this.isOpen&&(this.isOpen=!1,this.drawerEl.classList.remove("open"),this.drawerEl.setAttribute("aria-expanded","false"),this.triggerBtn.setAttribute("aria-pressed","false"))}async toggle(){this.isOpen?this.close():await this.open()}async refresh(){if(!this.sessionStartTime){console.warn("Cannot refresh: session start time not set"),this.showEmptyState("No active session");return}if(!e){console.error("SessionReview: cannot refresh without Tauri invoke");return}try{const s=this.sessionStartTime.toISOString();this.entries=await e("list_session_entries",{startTimeIso:s}),console.log(`Loaded ${this.entries.length} session entries`),this.render()}catch(s){console.error("Failed to load session entries:",s),this.showError(`Unable to load session log: ${s}`)}}render(){if(!this.entriesContainer)return;if(!this.entries||this.entries.length===0){this.showEmptyState("No check-ins yet. Stay mindful ‚ú®");return}this.emptyStateEl&&(this.emptyStateEl.style.display="none");const s=document.createDocumentFragment();this.entries.forEach(r=>{const c=this.createEntryElement(r);s.appendChild(c)}),this.entriesContainer.innerHTML="",this.entriesContainer.appendChild(s),this.updateSummary()}createEntryElement(s){const r=document.createElement("div");r.className="review-entry";const f=new Date(s.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return r.innerHTML=`
                <div class="entry-header">
                    <span class="entry-status">${s.statusLabel}</span>
                    <span class="entry-time">${f}</span>
                </div>
                ${s.note?`<div class="entry-note">${this.escapeHtml(s.note)}</div>`:""}
            `,r}updateSummary(){if(!this.summaryEl)return;const s=this.entries.filter(f=>f.status==="On Task").length,r=this.entries.filter(f=>f.status==="Social Media"||f.status==="Email/Chat"||f.status==="Other Distraction").length,c=this.entries.filter(f=>f.status==="Taking a Break").length;this.summaryEl.innerHTML=`
                <span class="summary-stat">‚úÖ On Task: ${s}</span>
                <span class="summary-stat">üö´ Distracted: ${r}</span>
                <span class="summary-stat">‚òïÔ∏è Breaks: ${c}</span>
            `}showEmptyState(s){this.entriesContainer&&(this.entriesContainer.innerHTML=""),this.emptyStateEl&&(this.emptyStateEl.textContent=s,this.emptyStateEl.style.display="block"),this.summaryEl&&(this.summaryEl.innerHTML='<span class="summary-stat">No data yet</span>')}showError(s){this.showEmptyState(`‚ö†Ô∏è ${s}`)}handleCheckInCreated(){console.log("Check-in created event received"),this.isOpen&&this.refresh()}escapeHtml(s){const r=document.createElement("div");return r.textContent=s,r.innerHTML}reset(){this.sessionStartTime=null,this.entries=[],this.close(),this.showEmptyState("Session reset")}}const o=new n;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>o.init()):o.init(),window.sessionReview=o})();let m,M,q,y;const t={};let a={sessionDuration:720,checkInInterval:15,writeTime:20},g=a.sessionDuration*60,d=a.checkInInterval*60,k=0,h=!1,S=!1,O=0,v=!1,E=null,w=null,T=null,b=null,R=null,_=null,p=!1,l=null,u=null,D=0,$=!1;const se=1e3,oe=6e4,re=15;async function B(){var e,n,o,i;if(!(m&&M&&q&&y)&&(await V(),m=(e=window.Tauri)==null?void 0:e.invoke,M=(n=window.Tauri)==null?void 0:n.listen,q=(o=window.Tauri)==null?void 0:o.emit,y=(i=window.Tauri)==null?void 0:i.appWindow,!m||!M||!y))throw new Error("Tauri APIs are not available. Run inside the Tauri shell.")}async function Y(e=""){var o;const n=e?` (${e})`:"";try{await B();const i=y||((o=window.Tauri)==null?void 0:o.appWindow);if(i!=null&&i.hide){await i.hide();return}}catch(i){console.error(`‚ùå Failed to hide window via JS${n}:`,i)}try{await m("hide_window")}catch(i){console.error(`‚ùå hide_window fallback failed${n}:`,i)}}function ae(){t.timerLabel=document.getElementById("timerLabel"),t.timer=document.getElementById("timer"),t.status=document.getElementById("status"),t.sessionProgress=document.getElementById("sessionProgress"),t.checkIns=document.getElementById("checkIns"),t.startBtn=document.getElementById("startBtn"),t.resetBtn=document.getElementById("resetBtn"),t.settingsBtn=document.getElementById("settingsBtn"),t.testBtn=document.getElementById("testBtn"),t.calendarBtn=document.getElementById("calendarBtn"),t.sessionGoal=document.getElementById("sessionGoal"),t.mainScreen=document.getElementById("mainScreen"),t.checkInScreen=document.getElementById("checkInScreen"),t.checkInGoalText=document.getElementById("checkInGoalText"),t.checkInNotes=document.getElementById("checkInNotes"),t.checkInCountdown=document.getElementById("checkInCountdown"),t.focusShieldBtn=document.getElementById("focusShieldBtn"),t.focusShieldBanner=document.getElementById("focusShieldBanner"),t.focusShieldText=document.getElementById("focusShieldText"),t.focusShieldCancelBtn=document.getElementById("focusShieldCancelBtn"),t.winClose=document.getElementById("winClose"),t.winMinimize=document.getElementById("winMinimize")}function J(e){const n=Math.max(0,Math.round(e)),o=Math.floor(n/60),i=n%60;return`${o}:${i.toString().padStart(2,"0")}`}function ce(e){return new Date(e).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}async function le(){try{const e=await m("get_settings");a={sessionDuration:e.session_duration||a.sessionDuration,checkInInterval:e.check_in_interval||a.checkInInterval,writeTime:e.write_time||a.writeTime},console.log("Settings loaded:",a),!h&&!S&&(g=a.sessionDuration*60,d=a.checkInInterval*60)}catch(e){console.error("Failed to load settings:",e)}}function C(e=Date.now()){E&&(g=Math.max(0,Math.ceil((E-e)/1e3))),w&&(d=Math.max(0,Math.ceil((w-e)/1e3))),T&&(k=Math.max(0,Math.ceil((T-e)/1e3)))}function H(){b||(R=Date.now(),b=setInterval(()=>{ue().catch(e=>console.error("Tick loop failed:",e))},se))}function F(e=!1){b&&(e||!h&&!S&&!p)&&(clearInterval(b),b=null,R=null)}function Q(e){return p&&l&&e<l}function Z(e){w=(l||e)+a.checkInInterval*60*1e3,C(e),u="Check-in postponed",I()}function de(e){console.log(`Sleep detected: ${Math.round(e/1e3)}s delay`),h&&(G({reason:"sleep"}),u=`Paused: Mac was asleep for ${Math.round(e/6e4)} min`),L(),C()}async function ue(){const e=Date.now();if(R){const n=e-R;n>oe&&de(n)}if(R=e,p&&l&&e>=l&&(p=!1,l=null,u="Focus Shield ended",L()),S&&T&&(k=Math.max(0,Math.ceil((T-e)/1e3)),z(),k<=0)){fe();return}if(h){if(E&&(g=Math.max(0,Math.ceil((E-e)/1e3)),g<=0)){me();return}if(w&&(d=Math.max(0,Math.ceil((w-e)/1e3)),d<=0)){Q(e)?Z(e):await te();return}}else S||C(e);I()}function L(){t.focusShieldBanner&&(p&&l?(t.focusShieldBanner.hidden=!1,document.querySelector(".app-shell").style.borderColor="rgba(255, 193, 7, 0.5)",t.focusShieldText&&(t.focusShieldText.textContent=`Shield active until ${ce(l)}`),t.focusShieldBtn&&(t.focusShieldBtn.textContent="üõ°Ô∏è Extend",t.focusShieldBtn.style.color="#ffc107")):(t.focusShieldBanner.hidden=!0,document.querySelector(".app-shell").style.borderColor="",t.focusShieldBtn&&(t.focusShieldBtn.textContent="üõ°Ô∏è Focus Shield",t.focusShieldBtn.style.color="")))}async function I(){L();const e=t.timerLabel,n=t.timer,o=t.status;let i="";if(S)e&&(e.textContent="‚úçÔ∏è LOG ACTIVITY"),n&&(n.textContent=`${k}`),o&&(o.textContent="Write what you're doing"),i=`‚úçÔ∏è ${k}s`;else{e&&(e.textContent="NEXT CHECK-IN"),n&&(n.textContent=J(d));let c=h?"Session active":"Ready";p&&l&&(c=`Focus Shield ‚Ä¢ ${Math.max(1,Math.ceil((l-Date.now())/6e4))} min`),u&&(c=u,u=null),o&&(o.textContent=c),i=J(d)}const s=Math.max(0,a.sessionDuration*60-g),r=Math.floor(s/60);if(t.sessionProgress&&(t.sessionProgress.textContent=`${r}m / ${a.sessionDuration}m`),t.checkIns){let c=`${O}`;D>0&&(c+=` (${D} skip)`),t.checkIns.textContent=c}$&&(i="üî¥ "+i);try{await m("update_tray_timer",{timerText:i})}catch(c){console.error("Failed to update tray timer:",c)}}function X(){h?G({reason:"user"}):ee()}async function ee({autoHide:e=!0}={}){const n=Date.now();!h&&!S&&((g<=0||g>a.sessionDuration*60)&&(g=a.sessionDuration*60),(d<=0||d>a.checkInInterval*60)&&(d=a.checkInInterval*60),window.sessionReview&&window.sessionReview.setSessionStartTime(new Date)),E=n+g*1e3,w=n+d*1e3,h=!0,t.startBtn&&(t.startBtn.textContent="Pause Focus",t.startBtn.style.background="rgba(255,255,255,0.1)",t.startBtn.style.color="#fff"),H(),I(),e&&await Y("start focus")}function G({reason:e}={}){h&&(C(),h=!1,E=null,w=null,t.startBtn&&(t.startBtn.textContent="Resume Focus",t.startBtn.style.background="white",t.startBtn.style.color="black"),e==="user"&&(u="Session paused"),I(),F())}function U(){h=!1,S=!1,O=0,D=0,$=!1,g=a.sessionDuration*60,d=a.checkInInterval*60,k=0,E=null,w=null,T=null,p=!1,l=null,v=!1,ne(),F(!0),A(),x(),window.sessionReview&&window.sessionReview.reset(),t.sessionGoal&&(t.sessionGoal.placeholder="What are you trying to achieve?"),t.startBtn&&(t.startBtn.textContent="Start Focus",t.startBtn.style.background="white",t.startBtn.style.color="black"),u="Ready",I()}async function te({forced:e=!1}={}){const n=Date.now();if(!e&&Q(n)){Z(n);return}C(n),G({reason:"check-in"});try{await m("position_window_centered"),await y.show(),await y.setFocus()}catch(o){console.error("Failed to show window:",o)}he(),S=!0,k=a.writeTime,T=Date.now()+a.writeTime*1e3,O+=1,z(),H(),I()}function he(){var n,o,i;const e=(((n=t.sessionGoal)==null?void 0:n.value)||"").trim()||"(No specific goal)";t.checkInGoalText&&(t.checkInGoalText.textContent=`"${e}"`),t.checkInNotes&&(t.checkInNotes.value=""),(o=t.mainScreen)==null||o.classList.add("hidden"),(i=t.checkInScreen)==null||i.classList.add("active"),document.body.classList.add("check-in-active"),z()}function ne(){var e,n;(e=t.mainScreen)==null||e.classList.remove("hidden"),(n=t.checkInScreen)==null||n.classList.remove("active"),document.body.classList.remove("check-in-active")}function z(){t.checkInCountdown&&(t.checkInCountdown.textContent=`Resuming session in ${k}s...`)}function fe(){D++,$=!0,W("Skip",{auto:!0})}async function W(e,n={}){var i,s;if(!S)return;n.auto||($=!1);const o={timestamp:new Date().toISOString(),session_goal:((i=t.sessionGoal)==null?void 0:i.value)||"",reported_status:e,notes:((s=t.checkInNotes)==null?void 0:s.value)||"",session_duration_setting:a.sessionDuration,check_in_interval_setting:a.checkInInterval,write_time_setting:a.writeTime,check_in_number:O,auto_submitted:!!n.auto,focus_shield_active:p};try{await m("log_check_in",{logLine:JSON.stringify(o)}),window.dispatchEvent(new CustomEvent("ft:checkin-created"))}catch(r){console.error("Failed to log check-in:",r)}await Y("check-in submit"),we({auto:n.auto,status:e})}function we({auto:e=!1,status:n}={}){S=!1,T=null,k=0,ne(),d=a.checkInInterval*60,w=Date.now()+d*1e3,e?u="Skipped":n?u=`Logged: ${n}`:u="Session active",I(),ee()}function me(){G(),F(!0),alert("Session complete! Great work! üéâ"),U()}function ye(){const e=Date.now(),n=re*60*1e3;if(p&&l&&l>e?(l+=n,u="Shield extended"):(l=e+n,u="Shield enabled"),p=!0,h&&w){const o=l+a.checkInInterval*60*1e3;w<o&&(w=o)}L(),H(),I()}function ge(){p=!1,l=null,u="Shield off",L(),I(),F()}async function pe(){try{await m("open_settings")}catch(e){console.error("Failed to open settings:",e)}}async function Ie(){await te({forced:!0})}async function j(e=!1){try{const n=await m("get_current_event");n?(t.sessionGoal&&(t.sessionGoal.value=n),v=!0,x(),Se()):e||alert("No calendar event found for the current time.")}catch(n){e||alert(n||"Failed to access calendar."),console.error("Calendar access failed:",n)}}function x(){const e=t.calendarBtn;e&&(v?(e.textContent="‚úÖ Synced",e.style.color="#48bb78"):(e.textContent="üìÖ Event",e.style.color=""))}function Se(){_&&clearInterval(_),_=setInterval(async()=>{if(v)try{const e=await m("get_current_event");e&&t.sessionGoal&&t.sessionGoal.value!==e?t.sessionGoal.value=e:e||(t.sessionGoal&&(t.sessionGoal.placeholder="No current event"),v=!1,x(),A())}catch{}},6e4)}function A(){_&&(clearInterval(_),_=null)}document.addEventListener("keydown",async e=>{var n;if(e.key==="Escape"){try{await B();const o=(n=window.Tauri)==null?void 0:n.appWindow;console.log("üîΩ ESC pressed - hiding window..."),o&&o.hide&&(await o.hide(),console.log("‚úÖ Window hidden via ESC"))}catch(o){console.error("‚ùå Failed to hide window on ESC:",o)}return}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.key==="I")try{await B(),await y.openDevtools()}catch{}});window.addEventListener("DOMContentLoaded",async()=>{await B(),ae(),L(),I();try{await m("position_window_centered")}catch(i){console.error("Failed to center window on startup:",i)}await y.onCloseRequested(async i=>{i.preventDefault(),await y.hide()}),t.startBtn&&t.startBtn.addEventListener("click",X),t.resetBtn&&t.resetBtn.addEventListener("click",U),t.settingsBtn&&t.settingsBtn.addEventListener("click",pe),t.testBtn&&t.testBtn.addEventListener("click",Ie),t.calendarBtn&&t.calendarBtn.addEventListener("click",()=>{v?(v=!1,x(),A(),t.sessionGoal&&(t.sessionGoal.value="")):j(!1)}),t.focusShieldBtn&&t.focusShieldBtn.addEventListener("click",ye),t.focusShieldCancelBtn&&t.focusShieldCancelBtn.addEventListener("click",ge);const e=document.getElementById("winClose"),n=document.getElementById("winMinimize");e&&e.addEventListener("click",async()=>{try{await B(),await y.hide()}catch(i){console.error("Failed to hide window:",i)}}),n&&n.addEventListener("click",async()=>{try{await B(),await y.minimize()}catch(i){console.error("Failed to minimize window:",i)}}),document.querySelectorAll(".check-in-buttons button").forEach(i=>{i.addEventListener("click",()=>{W(i.getAttribute("data-status"))})}),t.checkInNotes&&t.checkInNotes.addEventListener("keypress",i=>{i.key==="Enter"&&W("On Task")}),t.sessionGoal&&(t.sessionGoal.addEventListener("keypress",i=>{i.key==="Enter"&&!h&&X()}),t.sessionGoal.addEventListener("input",i=>{v&&i.inputType&&(v=!1,x(),A())})),await le(),U(),j(!0);const o=await M("settings-updated",i=>{if(i!=null&&i.payload){const s=i.payload;a={sessionDuration:s.session_duration||a.sessionDuration,checkInInterval:s.check_in_interval||a.checkInInterval,writeTime:s.write_time||a.writeTime};const r=Date.now();C(r),h&&(E=r+g*1e3,w=r+d*1e3),I()}});window.addEventListener("beforeunload",()=>o())});
